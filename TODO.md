# TrueDungeon Mod — TODO List

## Dungeon Map (Ключ и Задание)

### NBT-структура
- [x] Реализована структура NBT для предмета Dungeon Map:
  - dungeon_type
  - dungeon_level
  - dungeon_objective
  - dungeon_reward
  - dungeon_state ("sealed", "active", "complete")
- [x] Отображение Dungeon Map в тултипе с кастомным стилем и цветами уровня (звёзды).
- [x] Расширенный тултип при удержании Shift.
- [x] Добавлен тултип для party с отображением участников.
- [x] Реализована активация карты (ПКМ по запечатанной карте делает игрока лидером, устанавливает состояние и создаёт party).
- [x] Добавлены локализации для состояний карты (sealed, active, complete).
- [x] Исправлена ошибка с отправкой инвайта самому себе и двойной отправкой.
- [x] Добавлена система party для карт.

### Визуальные состояния предмета
- [ ] Модели и текстуры для трёх состояний:
  - `sealed` — запечатанное письмо
  - `active` — активный ключ
  - `complete` — выполненный квест
- [ ] Реализовать смену модели через `CustomModelData`

### Взаимодействие игрока
- [x] ПКМ по другому игроку — отправка приглашения в пати, чат-сообщение, подтверждение/отклонение, управление списком `party`
- [ ] ПКМ по двери с `sealed` — меняем состояние на `active` — проверка NBT, телепорт в подземелье, генерация данджа по типу и уровню

### Кооперативный режим
- [ ] Телепорт всех членов пати при активации ключа
- [ ] Синхронизация прогресса и статуса завершения для каждого участника
- [ ] Установка флага `dungeon_completed` для всех участников по окончании

## NPC — Квест-дилер

### Поведение и логика
- [x] Создание кастомного NPC (Entity) с MenuProvider и GUI
- [x] Генерация квестов по имени NPC через JSON (`dave_dealer.json`)
- [x] Случайный выбор типа/уровня/награды и генерация карт с нужным NBT
- [x] Система обновления квестов раз в день
- [x] Кнопка "Обновить квесты" доступна только для OP
- [x] Возможность принудительно обновить квесты (через кнопку)

### Сохранение состояния
- [x] Персистентный инвентарь NPC (3 слота) через `SimpleContainer`
- [x] Сохранение между сессиями
- [x] Предотвращение повторной генерации при выгрузке-загрузке

### UI и визуализация
- [x] GUI из 27 слотов (3 заполнены, остальные пусты)
- [x] Запрет вставки предметов
- [x] Реализация `CustomMenu` и сетевой синхронизации

## Утилиты и отладка
- [ ] Команды для выдачи кастомных карт с нужными NBT (для теста и администрирования)
- [x] Логирование ключевых событий: загрузка JSON, генерация квестов, клики по кнопке

---

# Notes

- Следить за совместимостью с мультиплеером.
- Убедиться, что вся логика работает на сервере, клиент не делает генерацию.
- Оптимизировать структуру кода по мере роста количества NPC и квестов.
